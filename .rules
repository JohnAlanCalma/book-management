service cloud.firestore {
  function isAuthenticated() {
    return request.auth != null;
  }
  function isMySelfDoc(userId) {
    return request.auth.uid == userId;
  }
  match /databases/{database}/documents {
    // PublicUser
    match /version/1/publicuser/{userId} {
	    // 認証さえされていれば全ユーザーに読み取り許可
	    // 書き込みは自分自身のみ許可
      allow read: if isAuthenticated();
      allow write: if isMySelfDoc(userId);
    }

    // PrivateUser
    match /version/1/privateuser/{userId} {
	    // 読み込み、書き込みは自分自身のみ許可
      allow read, write: if isMySelfDoc(userId);
    }
  }
}
